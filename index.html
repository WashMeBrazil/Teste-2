<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Wash Me</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js and Data Labels Plugin CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Modern Contrast (White/Light Gray BG, Blue 600, Green 600, Orange 600, Purple 600) -->
    <!-- Application Structure Plan: Restructured the layout to place the main interactive control (Vehicle Inputs) discreetly while prominently displaying the calculated Total Washes at the top. This creates a clean flow: Input (hidden) -> Total Services (visible) -> Chart -> Key Results -> Conclusion. This structure maximizes the visual space for the high-impact data elements. -->
    <!-- Visualization & Content Choices: Report Info: All four metrics (Water, Cost, Time, CO2) remain dynamic. -> Goal: Create a strong visual hierarchy where input is clearly separated from output/analysis. -> Viz/Presentation Method: Total services moved to header. Chart and Cards take full horizontal space. -> Interaction: Input fields drive all calculations. -> Justification: Improves user experience by following the natural top-down flow: Total Input -> Chart -> Key Results -> Conclusion. -> Library/Method: Chart.js (Canvas) for the chart, chartjs-plugin-datalabels, Vanilla JS for all logic. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; 
        }
        .highlight-blue {
            color: #2563eb; 
        }
        .highlight-green {
            color: #059669; 
        }
        .highlight-orange {
            color: #ea580c; 
        }
        .highlight-purple {
            color: #8b5cf6; /* Nova cor para CO2 */
        }
        .stat-card {
            background-color: white;
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.05); 
            transition: transform 0.3s ease-in-out;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            min-height: 180px;
        }
        .stat-card:hover {
            transform: translateY(-4px);
        }
        /* Ajuste do tamanho da fonte dos resultados para garantir que caibam em uma linha */
        .stat-result {
            font-size: 2.25rem; /* text-4xl no Tailwind */
            line-height: 2.5rem;
        }

        /* Removendo estilos espec√≠ficos do slider, mas mantendo o input number limpo */
        input[type="number"] {
            border: 2px solid #cbd5e1;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            text-align: center;
            font-weight: 600;
            color: #1f2937;
            width: 100%;
        }

        .calculator-controls {
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.06);
        }
        
        /* --- ESTILOS DE IMPRESS√ÉO PDF (LIMPOS) --- */
        @media print {
            /* Ocultar a se√ß√£o de inputs por categoria e o bot√£o de c√≥pia */
            #interactive-controls, #copy-button-container, #copy-success-message {
                display: none !important;
            }

            /* Quebra de p√°gina para o Estudo de Viabilidade */
            .viability-section {
                page-break-before: always !important; 
            }
            
            /* Garante visibilidade e cores do gr√°fico e cards */
            .stat-card {
                box-shadow: none !important;
                border: 1px solid #ccc;
                -webkit-print-color-adjust: exact; 
                color-adjust: exact;
            }
            .highlight-blue, .highlight-green, .highlight-orange, .highlight-purple {
                color: #1f2937 !important; 
            }
            
            /* Garante que o MAIN ocupe o espa√ßo e n√£o tenha sombra */
            main {
                box-shadow: none !important;
                border-radius: 0 !important;
            }
        }
    </style>
</head>
<body class="text-slate-800">
    <div class="flex flex-col items-center justify-center p-4 outer-container">
        <main class="w-full max-w-7xl mx-auto bg-white rounded-3xl shadow-2xl p-6 sm:p-10 md:p-12" id="calculator-content">
            <header class="text-center mb-6">
                <h1 class="text-4xl sm:text-5xl font-extrabold text-slate-900 mb-2">Calculadora Wash Me</h1>
                <p class="text-lg text-slate-500 max-w-4xl mx-auto">An√°lise de Impacto: Proje√ß√£o de Ganhos Estrat√©gicos para Gestores e Metas ESG.</p>
            </header>
            
            <!-- TOTAL DE SERVI√áOS (TOPO - FOCO DO RELAT√ìRIO) -->
            <section class="max-w-5xl mx-auto mb-10 bg-blue-50/50 p-4 rounded-xl border border-blue-200 total-area-print-focus">
                <div class="flex flex-col sm:flex-row justify-center items-center space-y-2 sm:space-y-0 sm:space-x-8">
                    <label class="text-2xl font-bold text-slate-700">TOTAL DE SERVI√áOS SIMULADOS:</label>
                    <span id="total-washes-count" class="text-5xl font-extrabold highlight-blue">0</span>
                </div>
            </section>
            
            <!-- CONTROLE DE SERVI√áOS (PARA INTERA√á√ÉO - VIS√çVEL NA TELA) -->
            <section class="mb-6 max-w-7xl mx-auto" id="interactive-controls">
                <div class="calculator-controls bg-slate-50 p-6 rounded-xl border border-slate-200">
                    <p class="text-sm font-semibold text-slate-600 mb-4 border-b pb-2 border-slate-200 text-center">DEFINA O VOLUME DE SERVI√áOS POR CATEGORIA</p>
                    
                    <div class="grid grid-cols-3 md:grid-cols-5 lg:grid-cols-10 gap-4 mb-6">
                        <!-- Conjunto (NOVO) -->
                        <div class="input-group">
                            <label for="input-conjunto" class="block text-sm font-medium text-slate-600 mb-2 text-center">Conjunto</label>
                            <input id="input-conjunto" type="number" min="0" value="0" class="focus:border-blue-500 focus:ring-blue-500">
                        </div>
                        <!-- Cavalo -->
                        <div class="input-group">
                            <label for="input-cavalo" class="block text-sm font-medium text-slate-600 mb-2 text-center">Cavalo</label>
                            <input id="input-cavalo" type="number" min="0" value="0" class="focus:border-blue-500 focus:ring-blue-500">
                        </div>
                        <!-- Carreta -->
                        <div class="input-group">
                            <label for="input-carreta" class="block text-sm font-medium text-slate-600 mb-2 text-center">Carreta</label>
                            <input id="input-carreta" type="number" min="0" value="0" class="focus:border-blue-500 focus:ring-blue-500">
                        </div>
                        <!-- Semi-reboque -->
                        <div class="input-group">
                            <label for="input-semi-reboque" class="block text-sm font-medium text-slate-600 mb-2 text-center">Semi-reboque</label>
                            <input id="input-semi-reboque" type="number" min="0" value="0" class="focus:border-blue-500 focus:ring-blue-500">
                        </div>

                        <!-- Rodotrem/Bitrem -->
                        <div class="input-group">
                            <label for="input-rodotrem-bitrem" class="block text-sm font-medium text-slate-600 mb-2 text-center">Rodotrem/Bitrem</label>
                            <input id="input-rodotrem-bitrem" type="number" min="0" value="0" class="focus:border-blue-500 focus:ring-blue-500">
                        </div>
                        
                        <!-- Truck -->
                        <div class="input-group">
                            <label for="input-truck" class="block text-sm font-medium text-slate-600 mb-2 text-center">Truck</label>
                            <input id="input-truck" type="number" min="0" value="0" class="focus:border-blue-500 focus:ring-blue-500">
                        </div>
                        <!-- Toco -->
                        <div class="input-group">
                            <label for="input-toco" class="block text-sm font-medium text-slate-600 mb-2 text-center">Toco</label>
                            <input id="input-toco" type="number" min="0" value="0" class="focus:border-blue-500 focus:ring-blue-500">
                        </div>
                        <!-- 3/4 -->
                        <div class="input-group">
                            <label for="input-tres-quartos" class="block text-sm font-medium text-slate-600 mb-2 text-center">3/4</label>
                            <input id="input-tres-quartos" type="number" min="0" value="0" class="focus:border-blue-500 focus:ring-blue-500">
                        </div>
                        <!-- Leves/Fiorino -->
                        <div class="input-group">
                            <label for="input-leves-fiorino" class="block text-sm font-medium text-slate-600 mb-2 text-center">Leves/Fiorino</label>
                            <input id="input-leves-fiorino" type="number" min="0" value="0" class="focus:border-blue-500 focus:ring-blue-500">
                        </div>
                         <!-- Sprinter/Van -->
                        <div class="input-group">
                            <label for="input-sprinter-van" class="block text-sm font-medium text-slate-600 mb-2 text-center">Sprinter/Van</label>
                            <input id="input-sprinter-van" type="number" min="0" value="0" class="focus:border-blue-500 focus:ring-blue-500">
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- CONTROLE DE COPIA -->
            <div id="copy-button-container" class="text-center mb-10">
                <div id="copy-success-message" class="bg-green-100 text-green-700 py-2 px-4 rounded-lg mb-3 hidden">
                    Conte√∫do do Relat√≥rio Copiado! Cole em um documento Word ou Google Docs para gerar o PDF.
                </div>
                <button onclick="copyReport()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-8 rounded-xl shadow-lg transition duration-300 transform hover:scale-[1.01] focus:outline-none focus:ring-4 focus:ring-indigo-300">
                    Copiar Relat√≥rio para Documento
                </button>
                <p class="mt-4 text-sm text-slate-500">Clique, cole em um editor de texto (Word/Docs), e use a fun√ß√£o "Salvar como PDF" do editor.</p>
            </div>


            <!-- GR√ÅFICO E RESULTADOS (ALINHAMENTO TOTAL) -->
            <div class="space-y-10">
                
                <!-- GR√ÅFICO (LARGURA TOTAL) -->
                <section class="bg-white p-6 rounded-xl border border-slate-200 shadow-lg print-only-section">
                    <h2 class="text-2xl font-bold text-center text-slate-800 mb-6">Comparativo de Consumo de √Ågua (Litros)</h2>
                    <p class="text-base text-slate-600 text-center mb-4 max-w-4xl mx-auto">
                        O gr√°fico visualiza o consumo total de √°gua entre os dois m√©todos para o n√∫mero de servi√ßos simulado.
                    </p>
                    <div class="chart-container relative w-full max-w-full mx-auto h-96 md:h-[450px]">
                        <canvas id="waterUsageChart"></canvas>
                    </div>
                </section>

                <!-- CART√ïES DE ECONOMIA (LARGURA TOTAL ABAIXO DO GR√ÅFICO) -->
                <section class="mb-12 print-only-section">
                    <h2 class="text-2xl font-bold text-slate-700 mb-6 text-center">GANHOS ESTRAT√âGICOS PROJETADOS</h2>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                        <!-- Cart√£o de Economia de √Ågua -->
                        <div class="stat-card border-b-8 border-blue-500 p-4 sm:p-6" style="border-left-color: #3b82f6;">
                            <div class="text-4xl mb-2">üíß</div>
                            <h3 class="text-lg font-semibold text-slate-600 mb-1">Preserva√ß√£o H√≠drica</h3>
                            <p id="water-saved" class="stat-result font-extrabold highlight-blue whitespace-nowrap">0 L</p>
                            <p class="text-xs text-slate-400 mt-1">Volume cr√≠tico de √°gua conservado.</p>
                        </div>

                        <!-- Cart√£o de Economia de CO2 -->
                        <div class="stat-card border-b-8 border-purple-500 p-4 sm:p-6" style="border-left-color: #a78bfa;">
                            <div class="text-4xl mb-2">üåø</div>
                            <h3 class="text-lg font-semibold text-slate-600 mb-1">Redu√ß√£o da Pegada CO2</h3>
                            <p id="co2-saved" class="stat-result font-extrabold highlight-purple whitespace-nowrap">0.00 kg</p>
                            <p class="text-xs text-slate-400 mt-1">Mitiga√ß√£o de emiss√µes por deslocamento.</p>
                        </div>

                        <!-- Cart√£o de Economia de Custo -->
                        <div class="stat-card border-b-8 border-green-500 p-4 sm:p-6" style="border-left-color: #10b981;">
                            <div class="text-4xl mb-2">üí∞</div>
                            <h3 class="text-lg font-semibold text-slate-600 mb-1">Otimiza√ß√£o de Capital</h3>
                            <p id="cost-saved" class="stat-result font-extrabold highlight-green whitespace-nowrap">R$ 0,00</p>
                            <p class="text-xs text-slate-400 mt-1">Redu√ß√£o direta nos custos de combust√≠vel.</p>
                        </div>
                        
                        <!-- Cart√£o de Tempo -->
                        <div class="stat-card border-b-8 border-orange-500 p-4 sm:p-6" style="border-left-color: #f97316;">
                            <div class="text-4xl mb-2">‚è±Ô∏è</div>
                            <h3 class="text-lg font-semibold text-slate-600 mb-1">Ganho Operacional</h3>
                            <p id="time-saved" class="stat-result font-extrabold highlight-orange whitespace-nowrap">0 min</p>
                            <p class="text-xs text-slate-400 mt-1">Tempo economizado em deslocamentos da frota.</p>
                        </div>
                    </div>
                </section>
            </div>


            <!-- Estudo de Viabilidade (Full Width) -->
            <section class="mt-8 pt-8 border-t-4 border-blue-500/50 viability-section print-only-section" id="viability-report">
                <h2 class="text-3xl font-bold text-slate-800 text-center mb-6">Estudo de Viabilidade Estrat√©gica e Alinhamento ESG</h2>
                <div class="max-w-4xl mx-auto text-lg text-slate-700 space-y-6 bg-slate-50 p-6 rounded-xl border border-slate-200">
                    <p>A presente an√°lise quantifica os benef√≠cios da ado√ß√£o do servi√ßo Wash Me, reposicionando a lavagem da frota de um custo operacional para um vetor de valor estrat√©gico. A migra√ß√£o do modelo tradicional para a nossa solu√ß√£o in loco representa um passo decisivo em Governan√ßa Ambiental e Otimiza√ß√£o de Recursos.</p>

                    <p>Com base na simula√ß√£o de <span id="viability-washes" class="font-extrabold highlight-blue">0</span> servi√ßos, o impacto imediato √© not√°vel e se alinha diretamente com indicadores de performance (KPIs) de diretoria:</p>

                    <ul class="list-disc list-inside space-y-3 pl-4">
                        <li class="font-semibold text-blue-700">Mitiga√ß√£o de Risco e Gest√£o H√≠drica:
                            <br>A economia de <span id="viability-water" class="font-extrabold text-blue-900">0 Litros</span> de √°gua mitiga o risco h√≠drico e reduz a depend√™ncia de recursos naturais escassos, um ponto crucial para investidores e relat√≥rios ESG. Consequentemente, poupamos <span id="viability-co2" class="font-extrabold text-purple-700">0.00 kg de CO2</span>, reduzindo a pegada de carbono da opera√ß√£o.</li>
                        
                        <li class="font-semibold text-green-700">Otimiza√ß√£o de Capital e Custo-Benef√≠cio:
                            <br>A elimina√ß√£o do deslocamento gera uma economia projetada de <span id="viability-cost" class="font-extrabold text-green-900">R$ 0,00</span> em custos de combust√≠vel. Este capital, antes queimado em transporte improdutivo, pode ser redirecionado para investimentos estrat√©gicos ou para o aumento da margem operacional.</li>
                        
                        <li class="font-semibold text-orange-700">Ganhos de Produtividade da Frota:
                            <br>A elimina√ß√£o do tempo de espera e tr√¢nsito resulta em um ganho operacional de <span id="viability-time" class="font-extrabold text-orange-700">0 min</span>. Este tempo recuperado aumenta a disponibilidade da frota e permite que os motoristas ou t√©cnicos se concentrem em suas atividades de alto valor.</li>
                    </ul>
                    
                    <p class="pt-4 font-bold text-slate-800">Conclus√£o: A solu√ß√£o Wash Me representa um Retorno Triplo‚Äî Ambiental, Operacional e Financeiro. Sugerimos a ado√ß√£o imediata para capitalizar estes ganhos e fortalecer a posi√ß√£o da empresa em sustentabilidade e efici√™ncia.</p>
                </div>
            </section>

            <!-- Observa√ß√µes T√©cnicas (Full Width) -->
            <section class="mt-8 max-w-4xl mx-auto text-sm text-slate-600 p-6 bg-slate-100 rounded-xl border border-slate-300 print-only-section" id="technical-notes">
                <h3 class="text-lg font-bold text-slate-700 mb-3">Observa√ß√£o T√©cnica e Par√¢metros Utilizados</h3>
                <p class="mb-2">Esta simula√ß√£o utiliza os seguintes par√¢metros fixos:</p>
                <ul class="list-disc list-inside space-y-1 pl-4">
                    <li>Consumo de √Ågua: Vari√°vel por categoria (Ex: Rodotrem/Bitrem = 1.500 Litros Tradicional vs. 15 Litros Ecol√≥gico; Conjunto = 600 Litros Tradicional vs. 15 Litros Ecol√≥gico).</li>
                    <li>Deslocamento Evitado: 10 km (5 km ida + 5 km volta) por servi√ßo.</li>
                    <li>Economia de Custo (Combust√≠vel): Baseada em R$ 5.99/Litro e efici√™ncia de 10 km/Litro. Economia de R$ 5.99 por Servi√ßo.</li>
                    <li>Economia de Tempo: 20 minutos de deslocamento evitado por Servi√ßo.</li>
                    <li>N√£o-Emiss√£o de CO2: Baseada na emiss√£o m√©dia de 0.231 kg de CO2 por km percorrido. Economia de 2.31 kg de CO2 por Servi√ßo.</li>
                </ul>
                <p class="mt-2 text-xs text-slate-500">Os c√°lculos s√£o projetados para ilustrar o potencial m√°ximo de economia. Valores reais podem variar conforme a efici√™ncia do ve√≠culo e o pre√ßo atual do combust√≠vel.</p>
            </section>


        </main>
    </div>

    <script>
        Chart.register(ChartDataLabels);

        document.addEventListener('DOMContentLoaded', () => {
            // A CORRE√á√ÉO: Definir todas as constantes no topo do bloco DOMContentLoaded

            // --- PAR√ÇMETROS FIXOS DE √ÅGUA GERAIS (Para contexto e escala inicial) ---
            const ECOLOGICAL_WASH_LITERS = 10;
            const TRADITIONAL_WASH_LITERS = 400; 

            // --- PAR√ÇMETROS FIXOS GERAIS (Dist√¢ncia, Custo, Tempo, CO2) ---
            const DISTANCE_KM = 10; 
            const FUEL_COST_PER_LITER = 5.99;
            const VEHICLE_EFFICIENCY_KML = 10; 
            const TIME_PER_WASH_MINUTES = 20; 
            const CO2_EMISSION_FACTOR_KG_KM = 0.231;

            // CUSTOS POR SERVI√áO EVITADO (S√£o iguais para todos os tipos pois dependem da DIST√ÇNCIA)
            const COST_PER_WASH_AVOIDED = (DISTANCE_KM / VEHICLE_EFFICIENCY_KML) * FUEL_COST_PER_LITER; 
            const CO2_PER_WASH_AVOIDED_KG = DISTANCE_KM * CO2_EMISSION_FACTOR_KG_KM;

            // --- NOVOS PAR√ÇMETROS DE √ÅGUA POR CATEGORIA ---
            const WATER_CONFIG = {
                'conjunto': { eco: 15, traditional: 600 }, // NOVO
                'leves-fiorino': { eco: 2, traditional: 250 },
                'sprinter-van': { eco: 3, traditional: 300 },
                'rodotrem-bitrem': { eco: 15, traditional: 1500 },
                'cavalo': { eco: 5, traditional: 200 },
                'carreta': { eco: 10, traditional: 400 },
                'semi-reboque': { eco: 10, traditional: 400 },
                'truck': { eco: 9, traditional: 375 },
                'toco': { eco: 8, traditional: 350 },
                'tres-quartos': { eco: 8, traditional: 350 },
            };
            
            // Novos elementos de input (para leitura)
            const inputConjunto = document.getElementById('input-conjunto');
            const inputCavalo = document.getElementById('input-cavalo');
            const inputCarreta = document.getElementById('input-carreta');
            const inputSemiReboque = document.getElementById('input-semi-reboque');
            const inputTruck = document.getElementById('input-truck');
            const inputToco = document.getElementById('input-toco');
            const inputTresQuartos = document.getElementById('input-tres-quartos');
            const inputLevesFiorino = document.getElementById('input-leves-fiorino');
            const inputSprinterVan = document.getElementById('input-sprinter-van');
            const inputRodotremBitrem = document.getElementById('input-rodotrem-bitrem');
            
            const totalWashesCountEl = document.getElementById('total-washes-count');
            
            // Elementos de Sa√≠da Principais
            const waterSavedEl = document.getElementById('water-saved');
            const co2SavedEl = document.getElementById('co2-saved'); 
            const costSavedEl = document.getElementById('cost-saved'); 
            const timeSavedEl = document.getElementById('time-saved'); 
            
            // Elementos do Estudo de Viabilidade
            const viabilityWashesEl = document.getElementById('viability-washes');
            const viabilityWaterEl = document.getElementById('viability-water');
            const viabilityCO2El = document.getElementById('viability-co2');
            const viabilityCostEl = document.getElementById('viability-cost');
            const viabilityTimeEl = document.getElementById('viability-time');
            const copySuccessMessageEl = document.getElementById('copy-success-message');


            // --- FUN√á√ïES DE FORMATA√á√ÉO ---
            const formatNumber = (num, isCurrency = false, decimalPlaces = 0) => {
                if (isCurrency) {
                    return num.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL', minimumFractionDigits: 2, maximumFractionDigits: 2 });
                }
                return num.toLocaleString('pt-BR', { maximumFractionDigits: decimalPlaces, minimumFractionDigits: decimalPlaces });
            };

            const formatTime = (totalMinutes) => {
                const hours = Math.floor(totalMinutes / 60);
                const minutes = Math.round(totalMinutes % 60); 
                if (hours > 0) {
                    return ${hours}h ${minutes}m;
                }
                return ${minutes} min;
            };
            // ------------------------------------------------------------------

            const ctx = document.getElementById('waterUsageChart').getContext('2d');
            let waterUsageChart; 

            function initializeChart(initialWashes) {
                // Para inicializa√ß√£o, usamos um valor padr√£o
                const totalEcoUsage = 0; 
                const totalTraditionalUsage = 0; 
                
                // Usando o maior consumo para escala inicial (Rodotrem/Bitrem: 1500L)
                const chartMax = WATER_CONFIG['rodotrem-bitrem'].traditional * 1.10; 

                waterUsageChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Lavagem Ecol√≥gica', 'Lavagem Tradicional'],
                        datasets: [{
                            label: 'Consumo de √Ågua (Litros)',
                            data: [totalEcoUsage, totalTraditionalUsage], 
                            backgroundColor: [
                                'rgba(16, 185, 129, 0.9)', 
                                'rgba(239, 68, 68, 0.9)' 
                            ],
                            borderColor: [
                                'rgba(16, 185, 129, 1)',
                                'rgba(239, 68, 68, 1)'
                            ],
                            borderWidth: 1.5
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.dataset.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.parsed.y !== null) {
                                            label += formatNumber(context.parsed.y) + ' L';
                                        }
                                        return label;
                                    }
                                }
                            },
                            datalabels: {
                                color: '#1e3a8a', 
                                anchor: 'end', 
                                align: 'top', 
                                offset: 8,      
                                font: {
                                    weight: '800',
                                    size: 14 
                                },
                                formatter: function(value, context) {
                                    return formatNumber(value) + ' L';
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: '#e5e7eb' 
                                },
                                title: {
                                    display: true,
                                    text: 'Litros',
                                    font: {
                                        size: 16,
                                        weight: '600'
                                    }
                                },
                                suggestedMax: chartMax 
                            },
                            x: {
                                grid: {
                                    display: false
                                },
                                ticks: {
                                    padding: 10,
                                    font: {
                                        size: 14
                                    }
                                }
                            }
                        }
                    }
                });
            }


            function updateValues() {
                // 1. L√ä E SOMA OS VALORES DOS INPUTS
                const washesConjunto = parseInt(inputConjunto.value) || 0; // NOVO
                const washesCavalo = parseInt(inputCavalo.value) || 0;
                const washesCarreta = parseInt(inputCarreta.value) || 0;
                const washesSemiReboque = parseInt(inputSemiReboque.value) || 0;
                const washesTruck = parseInt(inputTruck.value) || 0;
                const washesToco = parseInt(inputToco.value) || 0;
                const washesTresQuartos = parseInt(inputTresQuartos.value) || 0;
                const washesLevesFiorino = parseInt(inputLevesFiorino.value) || 0;
                const washesSprinterVan = parseInt(inputSprinterVan.value) || 0;
                const washesRodotremBitrem = parseInt(inputRodotremBitrem.value) || 0;


                // Total de servi√ßos √© a soma de todos os tipos
                const totalWashes = washesConjunto + washesCavalo + washesCarreta + washesSemiReboque + washesTruck + washesToco + washesTresQuartos + washesLevesFiorino + washesSprinterVan + washesRodotremBitrem;

                totalWashesCountEl.textContent = formatNumber(totalWashes);
                
                // 2. C√ÅLCULOS TOTAIS
                let totalEcoUsage = 0;
                let totalTraditionalUsage = 0;
                let maxTraditionalUsage = 0;

                // C√°lculo de √°gua espec√≠fico por categoria
                totalEcoUsage += washesConjunto * WATER_CONFIG.conjunto.eco;
                totalTraditionalUsage += washesConjunto * WATER_CONFIG.conjunto.traditional;

                totalEcoUsage += washesCavalo * WATER_CONFIG.cavalo.eco;
                totalTraditionalUsage += washesCavalo * WATER_CONFIG.cavalo.traditional;
                
                totalEcoUsage += washesCarreta * WATER_CONFIG.carreta.eco;
                totalTraditionalUsage += washesCarreta * WATER_CONFIG.carreta.traditional;
                
                totalEcoUsage += washesSemiReboque * WATER_CONFIG['semi-reboque'].eco;
                totalTraditionalUsage += washesSemiReboque * WATER_CONFIG['semi-reboque'].traditional;
                
                totalEcoUsage += washesTruck * WATER_CONFIG.truck.eco;
                totalTraditionalUsage += washesTruck * WATER_CONFIG.truck.traditional;

                totalEcoUsage += washesToco * WATER_CONFIG.toco.eco;
                totalTraditionalUsage += washesToco * WATER_CONFIG.toco.traditional;

                totalEcoUsage += washesTresQuartos * WATER_CONFIG['tres-quartos'].eco;
                totalTraditionalUsage += washesTresQuartos * WATER_CONFIG['tres-quartos'].traditional;

                // C√ÅLCULOS (Leves/Sprinter/Rodotrem)
                totalEcoUsage += washesLevesFiorino * WATER_CONFIG['leves-fiorino'].eco;
                totalTraditionalUsage += washesLevesFiorino * WATER_CONFIG['leves-fiorino'].traditional;

                totalEcoUsage += washesSprinterVan * WATER_CONFIG['sprinter-van'].eco;
                totalTraditionalUsage += washesSprinterVan * WATER_CONFIG['sprinter-van'].traditional;

                totalEcoUsage += washesRodotremBitrem * WATER_CONFIG['rodotrem-bitrem'].eco;
                totalTraditionalUsage += washesRodotremBitrem * WATER_CONFIG['rodotrem-bitrem'].traditional;


                // Define o m√°ximo para o gr√°fico
                maxTraditionalUsage = totalTraditionalUsage;

                const totalWaterSaved = totalTraditionalUsage - totalEcoUsage;
                
                // C√ÅLCULOS GERAIS (dependem apenas do totalWashes)
                const totalCostSaved = totalWashes * COST_PER_WASH_AVOIDED;
                const totalTimeSavedMinutes = totalWashes * TIME_PER_WASH_MINUTES;
                const totalCO2Saved = totalWashes * CO2_PER_WASH_AVOIDED_KG; 


                // 3. ATUALIZA√á√ÉO DA INTERFACE PRINCIPAL
                waterSavedEl.textContent = ${formatNumber(totalWaterSaved)} L;
                co2SavedEl.textContent = ${formatNumber(totalCO2Saved, false, 2)} kg; 
                costSavedEl.textContent = totalCostSaved > 0 ? formatNumber(totalCostSaved, true) : 'R$ 0,00';
                timeSavedEl.textContent = totalWashes > 0 ? formatTime(totalTimeSavedMinutes) : '0 min';
                
                // 4. ATUALIZA√á√ÉO DO ESTUDO DE VIABILIDADE
                viabilityWashesEl.textContent = formatNumber(Math.round(totalWashes));
                viabilityWaterEl.textContent = ${formatNumber(totalWaterSaved)} Litros;
                viabilityCO2El.textContent = ${formatNumber(totalCO2Saved, false, 2)} kg de CO2;
                viabilityCostEl.textContent = totalCostSaved > 0 ? formatNumber(totalCostSaved, true) : 'R$ 0,00';
                viabilityTimeEl.textContent = totalWashes > 0 ? formatTime(totalTimeSavedMinutes) : '0 min';

                // 5. Atualiza o gr√°fico
                if (waterUsageChart) {
                    const newChartMax = maxTraditionalUsage * 1.10; // 10% a mais
                    const defaultMax = WATER_CONFIG['rodotrem-bitrem'].traditional * 1.1;

                    waterUsageChart.data.datasets[0].data[0] = totalEcoUsage;
                    waterUsageChart.data.datasets[0].data[1] = totalTraditionalUsage;
                    
                    // Atualiza o suggestedMax dinamicamente
                    waterUsageChart.options.scales.y.suggestedMax = newChartMax > 0 ? newChartMax : defaultMax;

                    waterUsageChart.update();
                }
            }

            // Inicializa o gr√°fico
            initializeChart(0);
            
            // Event Listeners em todos os campos de input
            const inputElements = [inputConjunto, inputCavalo, inputCarreta, inputSemiReboque, inputTruck, inputToco, inputTresQuartos, inputLevesFiorino, inputSprinterVan, inputRodotremBitrem];
            inputElements.forEach(input => {
                input.addEventListener('input', updateValues);
            });
            
            // Inicializa√ß√£o da interface (com 0 servi√ßos)
            updateValues();


            // --- FUN√á√ÉO DE C√ìPIA DO RELAT√ìRIO ---
            window.copyReport = async function() {
                const contentToCopy = document.getElementById('calculator-content');
                const chartCanvas = document.getElementById('waterUsageChart');
                
                // 1. Clonar o conte√∫do para trabalhar com ele
                const clone = contentToCopy.cloneNode(true);
                
                // 2. Converter o gr√°fico Canvas em Imagem (PNG)
                const chartImg = document.createElement('img');
                chartImg.src = chartCanvas.toDataURL('image/png');
                chartImg.style.width = '600px'; 
                chartImg.style.height = '400px';
                chartImg.style.display = 'block';
                chartImg.style.margin = '20px auto';

                // 3. Ocultar inputs e substituir o Canvas pela imagem
                const clonedChartContainer = clone.querySelector('.chart-container');
                const clonedInteractiveControls = clone.querySelector('#interactive-controls');
                const clonedCopyButtonContainer = clone.querySelector('#copy-button-container');

                if (clonedInteractiveControls) { clonedInteractiveControls.remove(); }
                if (clonedCopyButtonContainer) { clonedCopyButtonContainer.remove(); }
                
                // Acha a se√ß√£o do gr√°fico e remove o canvas original
                const chartSection = clone.querySelector('.chart-container');
                if (chartSection) {
                    chartSection.innerHTML = ''; 
                    chartSection.appendChild(chartImg);
                }

                // 4. Injetar o clone tempor√°rio no DOM para a c√≥pia rica (rich text)
                const tempDiv = document.createElement('div');
                tempDiv.style.position = 'absolute';
                tempDiv.style.left = '-9999px';
                tempDiv.appendChild(clone);
                document.body.appendChild(tempDiv);
                
                // 5. Selecionar o conte√∫do e copiar
                const selection = window.getSelection();
                const range = document.createRange();
                range.selectNodeContents(tempDiv);
                selection.removeAllRanges();
                selection.addRange(range);
                
                let success = false;
                try {
                    // document.execCommand('copy') √© usado para compatibilidade em iframes
                    success = document.execCommand('copy');
                } catch(err) {
                    console.error('Falha ao copiar:', err);
                }

                // 6. Limpeza e feedback
                document.body.removeChild(tempDiv);
                
                if (success) {
                    copySuccessMessageEl.classList.remove('hidden');
                    setTimeout(() => {
                        copySuccessMessageEl.classList.add('hidden');
                    }, 5000);
                } else {
                    alert("Falha ao copiar o relat√≥rio. Seu navegador pode n√£o suportar esta fun√ß√£o.");
                }
            };
        });
    </script>
</body>
</html>
